<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gi√°m s√°t ƒê·ªô ·∫®m - N√¥ng Nghi·ªáp Th√¥ng Minh</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #e6f2e6;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .center-box {
      text-align: center;
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      width: 300px;
    }
    h1 {
      font-size: 1.8em;
      color: #4caf50;
      margin-bottom: 20px;
    }
    .data {
      font-size: 1.5em;
      color: #28a745;
      margin: 10px 0;
    }
    .status {
      font-size: 1.2em;
      color: #555;
    }
    .status.connected {
      color: green;
    }
    .status.disconnected {
      color: red;
    }
    .status.error {
      color: orange;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="center-box">
    <h1>üå± N√¥ng Nghi·ªáp Th√¥ng Minh</h1>
    <div class="data" id="mode">Mode: ƒêang ch·ªù d·ªØ li·ªáu...</div>
    <div id="mode0" class="hidden">
      <div class="data" id="setpoint">Setpoint: ƒêang ch·ªù d·ªØ li·ªáu...</div>
      <div class="data" id="humidity">Humidity: ƒêang ch·ªù d·ªØ li·ªáu...</div>
    </div>
    <div id="mode1" class="hidden">
      <div class="data" id="set_time">Set time: ƒêang ch·ªù d·ªØ li·ªáu...</div>
      <div class="data" id="delay">Delay: ƒêang ch·ªù d·ªØ li·ªáu...</div>
    </div>
    <div class="status" id="status">Ch∆∞a k·∫øt n·ªëi t·ªõi m√°y ch·ªß</div>
  </div>

  <script>
    const modeEl = document.getElementById('mode');
    const mode0El = document.getElementById('mode0');
    const mode1El = document.getElementById('mode1');
    const setTimeEl = document.getElementById('set_time');
    const delayEl = document.getElementById('delay');
    const setpointEl = document.getElementById('setpoint');
    const humidityEl = document.getElementById('humidity');
    const statusEl = document.getElementById('status');

    const socket = new WebSocket("wss://" + location.host);

    socket.onopen = () => {
      statusEl.textContent = "ƒê√£ k·∫øt n·ªëi t·ªõi m√°y ch·ªß WebSocket";
      statusEl.classList.remove('disconnected', 'error');
      statusEl.classList.add('connected');
    };

    socket.onmessage = (event) => {
      const raw = event.data.trim();
      const parts = raw.split(" ");

      if (parts.length === 2) {
        const key = parts[0];
        const value = parseInt(parts[1]);

        if (!isNaN(value)) {
          if (key === "Mode") {
            const modeText = (value % 2 === 0) ? "Mode 0" : "Mode 1";
            modeEl.textContent = modeText;
            if (value % 2 === 0) {
              mode0El.classList.remove('hidden');
              mode1El.classList.add('hidden');
            } else {
              mode0El.classList.add('hidden');
              mode1El.classList.remove('hidden');
            }
          } else if (key === "Set_time") {
            setTimeEl.textContent = `Set time: ${value} min`;
          } else if (key === "Delay") {
            delayEl.textContent = `Delay: ${value} H`;
          } else if (key === "Set_point") {
            setpointEl.textContent = `Setpoint: ${value}%`;
          } else if (key === "Humidity_01") {
            humidityEl.textContent = `Humidity: ${value}%`;
          }
        } else {
          console.error(`Gi√° tr·ªã kh√¥ng h·ª£p l·ªá cho ${key}: ${parts[1]}`);
        }
      } else {
        console.error(`D·ªØ li·ªáu nh·∫≠n kh√¥ng h·ª£p l·ªá: ${raw}`);
      }
    };

    socket.onclose = () => {
      statusEl.textContent = "M·∫•t k·∫øt n·ªëi WebSocket";
      statusEl.classList.remove('connected', 'error');
      statusEl.classList.add('disconnected');
    };

    socket.onerror = (error) => {
      statusEl.textContent = "L·ªói WebSocket";
      statusEl.classList.remove('connected', 'disconnected');
      statusEl.classList.add('error');
      console.error("WebSocket error:", error);
    };
  </script>
</body>
</html>
